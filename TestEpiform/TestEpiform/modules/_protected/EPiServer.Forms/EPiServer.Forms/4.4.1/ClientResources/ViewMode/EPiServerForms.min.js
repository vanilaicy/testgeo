(function(n){if(typeof epi=="undefined"||typeof epi.EPiServer=="undefined"||typeof epi.EPiServer.Forms=="undefined"){console.error("Forms is not initialized correctly");return}if(typeof n=="undefined"){console.error("Forms cannot work without jQuery");return}var t=epi.EPiServer.Forms.Utils,i=epi.EPiServer.Forms.Data,r=epi.EPiServer.Forms.Extension;epi.EPiServer.Forms.__DebounceTimer=null;epi.EPiServer.Forms.__Initialized=!(epi.EPiServer.Forms.__Initialized===undefined);n.extend(!0,epi.EPiServer.Forms,{Utils:{debounce:function(n,t){return function(){var i=this,r=arguments;clearTimeout(this.__DebounceTimer);this.__DebounceTimer=setTimeout(function(){n.apply(i,r)},t)}},loadExternalScriptOnDemand:function(n,t,i){for(var o=document.getElementsByTagName("head")[0],u=0,f=n.length,e=null,r;u<f;u++)e=n[u],r=document.createElement("script"),r.type="text/javascript",r.async=i||!1,r.defer=i||!1,r.src=e,o.appendChild(r),u===f-1&&this._setupCallback(r,t)},loadExternalCssOnDemand:function(n,t){for(var e=document.getElementsByTagName("head")[0],r=0,u=n.length,f=null,i;r<u;r++)f=n[r],i=document.createElement("link"),i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",f),e.appendChild(i),r===u-1&&this._setupCallback(i,t)},_setupCallback:function(n,t){typeof t=="function"&&(n.onload=t,n.onreadystatechange=function(){this.readyState=="complete"&&t()})},stringFormat:function(n,t){for(var i=n,r=t.length;r--;)i=i.replace(new RegExp("\\{"+r+"\\}","gm"),t[r]||"");return i},getConcatString:function(n,t){return n instanceof Array?n.join(t):n},htmlEncodeEntities:function(t){return n("<div><\/div>").text(t).html()},htmlDecodeEntities:function(n){var t=document.createElement("textarea");return t.innerHTML=n,t.value},isMatchedReg:function(n,t){var r=new RegExp(t),i=r.exec(n);return i!=null&&i.length>0},raiseFormsEvent:function(t,i){var u=n.extend(!0,{type:"forms",workingFormInfo:t},i),r;t?t.$workingForm.triggerHandler(u):(r=n(".EPiServerForms:eq(0)"),(!r||r.length<1)&&(r=n("body")),r.triggerHandler(u))},injectVisitorData:function(t){var r=n(".FormHidden[data-epiforms-visitordatasources]",t.$workingForm),i;r&&r.length!==0&&(i=null,r.each(function(){if(i=n(this),i&&i.length>0){var t=null;n(i.data("epiforms-visitordatasources").split(",")).each(function(n,r){t=epi.EPiServer.Forms.VisitorData[r];typeof t=="function"&&t(i)})}}))},getElementValue:function(t){return t.hasClass("FormFileUpload")?this.getPreviousPostedFiles(t):t.hasClass("FormChoice")?t.find(".FormChoice__Input:checked").map(function(t,i){return n(i).val()}).get():t.hasClass("FormSelection")?[].concat(t.find("select").val()):t.hasClass("FormCaptcha")||t.hasClass("FormTextbox")||t.hasClass("FormTextbox--Textarea")?n.trim(n(".FormTextbox__Input",t).val()):t.hasClass("FormRange")?n.trim(n(".FormRange__Input",t).val()):epi.EPiServer.Forms.Extension.getCustomElementValue(t)},getFormStepBlock:function(t,i){return t?n(".Form__Element [data-epiforms-element-name='"+t+"']",i):[]},getWorkingFormFromInnerElement:function(t){return n(t).parents(".EPiServerForms:first")},getFormIdentifier:function(n){return n.prop("id")},getPreviousPostedFiles:function(t){var i=t.find(".FormFileUpload__Input"),u=i.attr("name")||i.data("epiforms-element-name"),f=epi.EPiServer.Forms.Data.loadCurrentFormDataFromStorage(this.getWorkingFormFromInnerElement(i)),r=i[0].files;return n.each(f,function(n,t){if(n.indexOf("__TempData")!=-1&&n.replace("__TempData","")==u&&r.length==0)return r=t,!1}),r},getCurrentStepIndex:function(t){var i=n("input[name=__FormCurrentStepIndex]",t.$workingForm).val();return i===undefined||i.trim()===""||isNaN(+i)||+i>t.StepsInfo.Steps.length-1?t.StepsInfo.AllStepsAreNotLinked?i=0:n.each(t.StepsInfo.Steps,function(n,u){if(u.attachedContentLink==epi.EPiServer.CurrentPageLink&&r.isStepSatisfyDependentCondition(u,t))return i=n,!1}):i=+i,i},setCurrentStepIndex:function(t,i){return n("input[name=__FormCurrentStepIndex]",t.$workingForm).val(i),i},validateRegularExpressionValidator:function(n,i,r){if(!r||!r.model||!r.model.jsPattern||i==="")return{isValid:!0};if(!t.isMatchedReg(i,r.model.jsPattern)){var u=t.stringFormat(r.model.message,[r.model.jsPattern,r.description]);return{isValid:!1,message:u}}return{isValid:!0}},showNextStepOnEnterKeyDown:function(t){var i=n(t.target).parents(".EPiServerForms:first");return(keyCode=t.keyCode,$nextStepButton=n(".Form__NavigationBar .Form__NavigationBar__Action.btnNext",i),$buttonSubmitSections=n(".Form__Element.FormSubmitButton",i).parent(".FormStep").filter(function(){return!n(this).hasClass("hide")}),keyCode==13&&$buttonSubmitSections.length==0&&$nextStepButton!=null&&$nextStepButton.length)?(t.preventDefault(),t.stopPropagation(),$nextStepButton.trigger("click"),!0):!0}},Extension:{getSummarizedText:function(i,r,u){var h=u?"<br/>":"\n",y=u?i.ConfirmMessage:t.htmlDecodeEntities(i.ConfirmMessage),c=i.ElementsInfo,l=[],a=[],p=["__FormGuid","__FormLanguage","__FormCurrentStepIndex","__FormSubmissionId"],v=i.ConfirmMessage?y+h+h:"",s=null,f=null,e,o;for(e in r)if(l.indexOf(e.replace("__TempData",""))==-1){if(o=e.indexOf("__TempData")!=-1?c[e.replace("__TempData","")]:c[e],s=o&&o.friendlyName?o.friendlyName:"",f=o&&o.customBinding==!0?epi.EPiServer.Forms.CustomBindingElements[o.type](o,r[e]):r[e],(f==null||f instanceof Array&&f.length===0||n.isEmptyObject(f))&&(f=""),f instanceof Array?f=n.map(f,function(n){return n?typeof n=="string"?n:typeof n=="object"?n.name:void 0:null}).join(", "):f instanceof FileList&&f.length==0?f="":(f=f.toString().substr(0,46).trim(),f.length>=45&&(f+=" ...")),n("[name="+e+"]",i.$workingForm).hasClass("FormHideInSummarized")&&a.push(e),s==""||s==null||f==""||f==null||p.indexOf(e)>=0||a.indexOf(e)>=0)continue;else l.push(e);v+=u?t.stringFormat("{0}: {1}"+h,[s,t.htmlEncodeEntities(f)]):t.stringFormat("{0}: {1}"+h,[t.htmlDecodeEntities(s),f])}return v},showSummarizedText:function(t,i){var r=n.Deferred(),u=this.getSummarizedText(i,t,!1),f;return!u||u.trim()===""?(r.resolve(!0),r.promise()):(f=confirm(u),r.resolve(f),r.promise())},getCustomElementValue:function(n){return n.val()},bindCustomElementValue:function(n,t){var i=n.find(".Form__CustomInput");i.val(t)},isStepSatisfyDependentCondition:function(n,t){if(!n)return!1;var r=n.dependField,u=i.loadCurrentFormDataFromStorage(t.$workingForm),f=epi.EPiServer.Forms.DependConditions[n.dependCondition];return!r||!f||!u?!0:f(u[r],n.dependValue)}},Data:{loadCurrentFormDataFromStorage:function(t){var r=this.getStorage(),i=r[epi.EPiServer.Forms.Utils.getFormIdentifier(t)];return i?(i=n.parseJSON(i),!i)?{}:i:{}},saveCurrentFormDataToStorage:function(n,t){var i=this.getStorage();return i.setItem(epi.EPiServer.Forms.Utils.getFormIdentifier(n),JSON.stringify(t)),t},clearFormDataInStorage:function(n){this.getStorage().removeItem(epi.EPiServer.Forms.Utils.getFormIdentifier(n))},getStorage:function(){return sessionStorage}}});var u=i.getStorage(),f={VisitorData:{"EPiServer.Forms.Implementation.VisitorData.GeoVisitorDataSource":function(t){n.ajax({url:"/EPiServer.Forms/DataSubmit/GetGeoData",type:"POST",success:function(n){var r=t.val(),i;r||(i=t.data("epiforms-visitordataproperty"),n!=null&&n[i]&&t.val(n[i]))}})}}},e={Validators:{"EPiServer.Forms.Implementation.Validation.RequiredValidator":function(n,t,i){return i&&(t==""||t&&!t.length)?{isValid:!1,message:i.model.message}:{isValid:!0}},"EPiServer.Forms.Implementation.Validation.RegularExpressionValidator":t.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.EmailValidator":t.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.UrlValidator":t.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.DateDDMMYYYYValidator":t.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.DateMMDDYYYYValidator":t.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.DateYYYYMMDDValidator":t.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.IntegerValidator":t.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.PositiveIntegerValidator":t.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.AllowedExtensionsValidator":function(n,t,i){function h(n,t,i){var r=c(n);return r.length<1?!1:(r=r.toLowerCase(),t.indexOf(r)>=0)?!1:i.length<1?!0:i.indexOf(r)>-1}function c(n){return n.substr((~-n.lastIndexOf(".")>>>0)+2)}if(!t||t instanceof Array&&t.length==0)return{isValid:!0};var o=t,r=i.model.accept,l=epi.EPiServer.Forms.UploadExtensionBlackList.split(","),u=r==undefined||r.length<1?[]:r.split(","),f=0,e=0,s=u.length,a=o.length;if(s>0)for(;f<s;f++)u[f]=u[f].substr(1);for(;e<a;e++)if(!h(o[e].name,l,u))return{isValid:!1,message:epi.EPiServer.Forms.Utils.stringFormat(i.model.message,[r])};return{isValid:!0}},"EPiServer.Forms.Implementation.Validation.MaxFileSizeValidator":function(n,t,i){for(var u=t,r=0,e=u.length,f=i.model.sizeInBytes;r<e;r++)if(u[r].size>f)return{isValid:!1,message:epi.EPiServer.Forms.Utils.stringFormat(i.model.message,[f/1048576])};return{isValid:!0}},"EPiServer.Forms.Implementation.Validation.NumericValidator":function(t,i,r){return!i||n.isNumeric(i)==!0?{isValid:!0}:{isValid:!1,message:r.model.message}},"EPiServer.Forms.Implementation.Validation.CaptchaValidator":{initialize:function(t){var i=this;t.parents(".FormCaptcha").find(".FormCaptcha__Refresh").on("click",function(t){i._refreshCaptcha(n(this));t.preventDefault()})},validate:function(n,t){var i=t.trim();return i!=null&&i!=""},onServerValidateFailed:function(n){this._refreshCaptcha(n);n.focus()},_refreshCaptcha:function(n){var t=n.hasClass("FormCaptcha")?n:n.parents(".FormCaptcha"),i=t.find(".FormCaptcha__Image"),r=t.find(".FormTextbox__Input");i.attr("src",i.attr("src")+"&d="+Math.random());r.val("")}}}},o={DependConditions:{Equals:function(n,t){return n=n?epi.EPiServer.Forms.Utils.getConcatString(n,",").toUpperCase():"",t=t?t.toUpperCase():"",n===t},NotEquals:function(n,t){return n=n?epi.EPiServer.Forms.Utils.getConcatString(n,",").toUpperCase():"",t=t?t.toUpperCase():"",n!=t},Contains:function(n,t){return n=n?epi.EPiServer.Forms.Utils.getConcatString(n,",").toUpperCase():"",t=t?t.toUpperCase():"",n.indexOf(t)>=0},NotContains:function(n,t){return n=n?epi.EPiServer.Forms.Utils.getConcatString(n,","):"",!n&&t||n&&!t||n&&t&&n.toUpperCase().indexOf(t.toUpperCase())<0},MatchRegularExpression:function(n,t){var i=new RegExp(t,"igm");return i.ignoreCase=i.global=i.multiline=!0,!t||t&&i.test(n)}}};n.extend(!0,epi.EPiServer.Forms,f);n.extend(!0,epi.EPiServer.Forms,e);n.extend(!0,epi.EPiServer.Forms,o);n.extend(!0,epi.EPiServer.Forms,{CustomBindingElements:{}});epi.EPiServer.Forms.init=function(){epi.EPiServer.Forms.__Initialized||(epi.EPiServer.Forms.__Initialized=!0,n(document).ready(function(){function v(i){var u,r,c,o;if(i.preventDefault(),i.stopPropagation(),u=t.getWorkingFormFromInnerElement(i.target),r=e(u),r.SubmittableStatus.submittable===!1)return f(r,r.SubmittableStatus.message),!1;if(c=h(r),!g(c,r))return s(c),!1;o=ot(u);n.when(ft(r,o)).then(function(e){var h,c,s,v,a,y;if(!e)return!1;h=[];c=null;for(s in o)s.indexOf("__TempData")==-1&&(c=t.getFormStepBlock(s,u),c.parents(".FormStep:first").hasClass("hide")||(v=l(r.ValidationInfo,s),h=h.concat(nt(s,o[s],v))));if(a=n.grep(h,function(n){return n.isValid==!1}),a.length>0)return y=n.map(a,function(n){return r.ElementsInfo[n.fieldName].friendlyName+": "+n.message}),f(r,y.join(" ")),!1;w(i)})}function y(n){n.preventDefault();n.stopPropagation();var r=t.getWorkingFormFromInnerElement(n.target),i=e(r);t.raiseFormsEvent(i,{type:"formsReset",sourceEvent:n});p(r,i);o(i.StepsInfo.Steps[0],i)}function p(t,r){t.get(0).reset();r.SubmittableStatus&&r.SubmittableStatus.submittable===!1?f(r,r.SubmittableStatus.message):f(r,"");i.clearFormDataInStorage(t);n(".Form__Element",t).each(function(t,i){var r=n(i);c(r).text("");r.hasClass("FormChoice")?r.find("input[type=checkbox], input[type=radio]").each(function(t,i){var r=n(i);r.prop("checked",r.data("epiforms-default-value")?!0:!1)}):r.hasClass("FormSelection")?(r.find("option[disabled]:eq(0)").prop("selected",!0),r.find("option").each(function(t,i){var r=n(i);r.prop("disabled")===!1&&r.prop("selected",r.data("epiforms-default-value")?!0:!1)})):r.hasClass("FormFileUpload")&&(b(r).text(""),rt(r.find(".FormFileUpload__Input")))})}function w(r){var c=t.getWorkingFormFromInnerElement(r.target),st=epi.EPiServer.Forms.Utils.getFormIdentifier(c),u=e(c),d=i.saveCurrentFormDataToStorage(c,k(c)),s=new FormData,nt=t.getCurrentStepIndex(u),g=tt(nt,u),w=g?!1:!0,v=n(r.srcElement||r.target),ht=v.val(),ot=!!v.data("epiforms-is-progressive-submit"),l,y,it,ft,et,b;w=w||!!v.data("epiforms-is-finalized");d[v.prop("name")]=v.val();s.append("__FormGuid",st);s.append("__FormHostedPage",epi.EPiServer.CurrentPageLink);s.append("__FormLanguage",epi.EPiServer.CurrentPageLanguage);s.append("__FormCurrentStepIndex",nt);s.append("__FormWithJavaScriptSupport","true");for(y in d)if(d.hasOwnProperty(y))if(l=d[y],Array.isArray(l)&&l.length>0&&l[0]!==null&&typeof l[0]=="object"&&l[0].file&&Object.getPrototypeOf(l[0].file)===File.prototype){for(it=l,ft="",b=0;b<it.length;b++)et=it[b].file,s.append(y+"_file_"+b,et),ft+=et.name+"|";s.append(y,ft)}else s.append(y,l);t.raiseFormsEvent(u,{type:"formsStartSubmitting",formData:s});v.prop("disabled",!0);f(u,"");n.ajax({url:u.DataSubmitController+"/Submit",data:s,cache:!1,type:c.prop("method"),processData:!1,contentType:!1,async:epi.EPiServer.Forms.AsyncSubmit||c.data("epiforms-async-submit")||!1,success:function(e){var v,y,b,l;if(r.preventDefault(),n(".Form__Element__ValidationError").text(""),e.IsSuccess===!0){if(v=h(u),n(".FormFileUpload .FormFileUpload__Input",v).each(function(){n(this).val("");rt(n(this))}),w==!1&&ot==!1)return t.raiseFormsEvent(u,{type:"formsNavigationNextStep",targetStep:g}),y=i.loadCurrentFormDataFromStorage(c),b=n.extend(y,{__FormSubmissionId:e.Data.SubmissionId}),i.saveCurrentFormDataToStorage(c,b),t.raiseFormsEvent(u,{type:"formsSubmitted",formData:s,isFinalizedSubmission:!1,isSuccess:e.IsSuccess,returnedResult:e}),o(g,u),!1;if(w==!0&&p(c,u),t.raiseFormsEvent(u,{type:"formsSubmitted",formData:s,isFinalizedSubmission:w,isSuccess:e.IsSuccess,returnedResult:e}),l=u.StepsInfo.Steps.length,e.RedirectUrl)return window.location.href=e.RedirectUrl,!1;ot==!1&&!g&&nt<l-1?o(u.StepsInfo.Steps[l-1],u):(n(".Form__MainBody",u.$workingForm).hide(),f(u,e.Message,!0))}else a(u),t.raiseFormsEvent(u,{type:"formsSubmitted",formData:s,isSuccess:e.IsSuccess,returnedResult:e}),e.Message&&f(u,e.Message),e.Data&&e.Data.ValidationInfo&&e.Data.ValidationInfo.length>0&&ut(u,e.Data.ValidationInfo)},error:function(n,i,e){r.preventDefault();t.raiseFormsEvent(u,{type:"formsSubmittedError",formData:s,isSuccess:!1,returnedResult:returnedResult,xhr:n,typeOfFailure:i,status:e});f(u,i+" "+n.status+": "+e)},complete:function(){v.prop("disabled",!1);a(u)}})}function ut(t,i){for(var o,f,u=null,r=0;r<i.length;r++)if(i[r]&&i[r].InvalidElement){u=n("#"+i[r].InvalidElement+"",t.$workingForm);var h=c(u),a=l(t.ValidationInfo,i[r].InvalidElement),e=ht(a,i[r].Validator);e&&(o=epi.EPiServer.Forms.Validators[e.type],f=o.onServerValidateFailed,f&&typeof f=="function"&&f.apply(o,[u,e]));h.text(i[r].ValidationMessage||epi.EPiServer.Forms.Messages.viewMode.commonValidationFail).show()}u&&s(u.parents(".FormStep:first"))}function ft(t,i){var u=n.Deferred(),f,e;return t.ShowSummarizedData?(f=[],e=["__FormGuid","__FormLanguage","__FormCurrentStepIndex","__FormSubmissionId"],r.showSummarizedText(i,t,e,f)):(u.resolve(!0),u.promise())}function f(t,i,r){if(t){var u=n(".Form__Status__Message",t.$workingForm);u.removeClass("Form__Warning__Message").removeClass("Form__Success__Message");r==!0&&i?u.removeClass("hide").addClass("Form__Success__Message").html(i):i?u.removeClass("hide").addClass("Form__Warning__Message").html(i):u.addClass("hide").html("")}}function et(i,u){n.each(i,function(i,f){var e=n('[name="'+i+'"]',u),s,o,h,c,l,a,v;if(i.indexOf("__TempData")!=-1&&(e=n('[name="'+i.replace("__TempData","")+'"]',u)),e.length>0){if(e.hasClass("FormExcludeDataRebind"))return;if(e.hasClass("FormChoice__Input--Checkbox")){n.each(e,function(){var t=n(this).val();n(this).attr("checked",f.indexOf(t)>-1)});return}if(e.hasClass("FormChoice__Input--Radio")){s=n.isArray(f)?f[0]:f;n.each(e,function(){var t=n(this).val();n(this).attr("checked",s==t)});return}if(e.parents(".FormSelection:first").length>0){n("option",e).each(function(t,i){n(i).attr("selected",f.indexOf(n(i).val())>-1)});return}if(e.hasClass("FormCaptcha__Input"))return;if(e.hasClass("FormFileUpload__Input")){o="";h=e.parents(".FormFileUpload:first");f instanceof Array&&f.length>0&&(c=f.map(function(n){return n.name}).join(", "),o=o.concat(c));o!==""&&(l=t.stringFormat(epi.EPiServer.Forms.Messages.fileUpload.postedFile,[o]),a=b(h),a.text(l).show());return}if(e.hasClass("Form__CustomInput")){v=e.parents(".Form__CustomElement:first");r.bindCustomElementValue(v,f);return}e.val(f)}})}function b(n){return n.find(".FormFileUpload__PostedFile")}function k(t,r){var u=e(t),f=h(u),o=d(f,r),s=i.loadCurrentFormDataFromStorage(t);return n.extend(s,o)}function ot(t){var r=d(t),u=i.loadCurrentFormDataFromStorage(t);return n.extend(u,r)}function e(n){var r=t.getFormIdentifier(n),i=epi.EPiServer.Forms[r];return i.$workingForm=n,i}function d(i,r){var u={};return n(".Form__Element, .Form__CustomElement",i).not(".FormStep,.Form__Element--NonData").each(function(i,f){if(($el=n(f),typeof r!="function"||!r($el))&&!$el.parents(".FormStep:first").hasClass("hide")){var e=f.name||$el.data("epiforms-element-name");e&&(u[e]=t.getElementValue($el))}}),n(".FormFileUpload .FormFileUpload__Input",i).each(function(){var i,o,f,e;if((typeof r!="function"||!r(n(this)))&&this.name&&this.files!=undefined)if(i=this.name+"__TempData",u[this.name]=[],u[i]=[],this.files.length===0)o=t.getPreviousPostedFiles(n(this).parents(".FormFileUpload:first")),u[this.name]=o,u[i]=o;else for(f=0;f<this.files.length;f++)e=this.files[f],u[this.name].push({name:e.name,file:e}),u[i].push({name:e.name})}),u}function g(i,r){if(!i)return!0;var u=!0;return n(".FormTextbox, .FormTextbox--Textarea, .FormSelection, .FormChoice, .FormFileUpload, .Form__CustomElement",i).each(function(n,t){u=st(t,r)&&u}),t.raiseFormsEvent(r,{type:"formsStepValidating",isValid:u}),r.$workingForm.toggleClass("ValidationSuccess",u),r.$workingForm.toggleClass("ValidationFail",!u),u}function st(i,r){var u=n(i),o=c(u),s=u.attr("name")||u.data("epiforms-element-name"),v=u.attr("id")||s,h=l(r.ValidationInfo,v),f=!0,a,y,e,p;return u.removeClass("ValidationFail ValidationSuccess"),o.hide(),a=t.getElementValue(u),h instanceof Array&&h.length>0&&(y=nt(s,a,h),e=n.grep(y,function(n){return n.isValid==!1}),e&&e.length>0?(p=n.map(e,function(n){return n.message}),u.addClass("ValidationFail"),o.text(p.join(" ")).show(),f=!1):(u.addClass("ValidationSuccess"),f=!0)),t.raiseFormsEvent(r,{type:"elementValidated",isValid:f,elementName:s,elementValue:a,elementIdentifier:v,element:i,$messageContainer:o}),f}function nt(t,i,r){var u=[];return n(r).each(function(r,f){var e=epi.EPiServer.Forms.Validators[f.type],o=null,s;typeof e=="function"?o=e:typeof e.validate=="function"&&(o=e.validate);o&&(s=o(t,i,f),n.extend(s,{fieldName:t,fieldValue:i}),u.push(s))}),u}function c(i){var r=i.attr("name")||i.data("epiforms-element-name"),u=t.stringFormat("{0}[data-epiforms-linked-name='{1}'], {0}[data-epiforms-linked-name='{2}']",[".Form__Element__ValidationError",r,i.attr("id")]);return n(u)}function l(n,t){if(n instanceof Array&&n.length!==0&&t)for(var r=0,u=n.length,i=null;r<u;r++)if((i=n[r],i)&&(i.targetElementId===t||i.targetElementName===t))return i.validators}function ht(n,t){if(n instanceof Array&&n.length!==0&&t)for(var r=0,i=null,u=n.length;r<u;r++)if((i=n[r],i)&&i.type===t)return i}function ct(r){if(r&&r.StepsInfo&&r.StepsInfo.Steps&&(r.$steps=n(".FormStep",r.$workingForm),!(r.StepsInfo.Steps.length<2))){var u=r.StepsInfo.Steps[t.getCurrentStepIndex(r)];o(u,r);n(".Form__NavigationBar__Action.btnNext",r.$workingForm).on("click",function(n){n.preventDefault();var t=h(r),i=g(t,r);if(!i)return s(t),!1;w(n)});n(".Form__NavigationBar__Action.btnPrev",r.$workingForm).on("click",function(u){var e,f,h;u.preventDefault();e=k(r.$workingForm,function(n){return n.hasClass("FormFileUpload")});i.saveCurrentFormDataToStorage(r.$workingForm,e);f=it(t.getCurrentStepIndex(r),r);o(f,r);h=n("section[data-epiforms-stepindex="+f.index+"]",r.$workingForm);s(h);t.raiseFormsEvent(r,{type:"formsNavigationPrevStep",targetStep:f})})}}function o(r,u){if(r){t.raiseFormsEvent(u,{type:"formsNavigateToStep",targetStep:r});var e=i.loadCurrentFormDataFromStorage(u.$workingForm);if(et(e,u.$workingForm),u.StepsInfo.AllStepsAreNotLinked||r.attachedContentLink==epi.EPiServer.CurrentPageLink)u.$steps.addClass("hide"),u.$steps.each(function(i,f){if(i===r.index)return n(f).removeClass("hide"),t.setCurrentStepIndex(u,r.index),!1}),lt();else{if(r.attachedUrl&&r.attachedUrl.length){window.location.replace(r.attachedUrl);return}u.StepsInfo.AllStepsAreNotLinked||f(u,epi.EPiServer.Forms.Messages.viewMode.malformStepConfiguration)}}else u.$steps.hide();a(u)}function s(t){epi.EPiServer.Forms.Validators["EPiServer.Forms.Implementation.Validation.CaptchaValidator"]._refreshCaptcha(n(".Form__Element.FormCaptcha",t))}function lt(){var t=n(".Form__Title");t.css("position").toLowerCase()!=="fixed"&&n(document).scrollTop()>0&&window.scrollTo(0,t.offset().top)}function a(i){var u=t.getCurrentStepIndex(i),r=n(".Form__NavigationBar",i.$workingForm),o,s,f,e;if(u<0){r.hide();return}o=n(".Form__NavigationBar__Action.btnPrev",r).prop("disabled",!1);s=n(".Form__NavigationBar__Action.btnNext",r).prop("disabled",!1);(u==0||i.SubmittableStatus.submittable===!1)&&o.prop("disabled",!0);(u==i.StepsInfo.Steps.length-1||i.SubmittableStatus.submittable===!1)&&s.prop("disabled",!0);n(".Form__NavigationBar",i.$workingForm).toggle(i.ShowNavigationBar);f=u+1;e=i.StepsInfo.Steps.length;n(".Form__NavigationBar__ProgressBar__CurrentStep",r).text(f);n(".Form__NavigationBar__ProgressBar__StepsCount",r).text(e);n(".Form__NavigationBar__ProgressBar--Progress",r).css({width:100*f/e+"%"})}function tt(n,t){var r=null,u=n+1,i=t.StepsInfo.Steps[u];return i&&(r=epi.EPiServer.Forms.Extension.isStepSatisfyDependentCondition(i,t)?i:tt(u,t)),r}function it(n,t){var r=null,u=n-1,i=t.StepsInfo.Steps[u];return i&&(r=epi.EPiServer.Forms.Extension.isStepSatisfyDependentCondition(i,t)?i:it(u,t)),r}function h(i){var r=t.getCurrentStepIndex(i);return n(i.$steps[r])}function rt(n){/MSIE/.test(navigator.userAgent)&&n.replaceWith(n=n.clone(!0))}if(!u){n(".EPiServerForms .Form__Status__Message").text(epi.EPiServer.Forms.ErrorMessages.cantnotworkwithoutstorage);return}n(".EPiServerForms").each(function(i,r){var o=n(r),u=e(o);u.SubmittableStatus&&u.SubmittableStatus.submittable===!1&&f(u,u.SubmittableStatus.message);ct(u);n(u.ValidationInfo).each(function(t,i){n(i.validators).each(function(t,r){var u=epi.EPiServer.Forms.Validators[r.type];u&&typeof u.initialize=="function"&&u.initialize(n("#"+i.targetElementId))})});t.injectVisitorData(u);n(".Form__Element.FormSubmitButton",o).off("click",v).on("click",v);n(".Form__Element.FormResetButton",o).off("click",y).on("click",y);t.raiseFormsEvent(u,{type:"formsSetupCompleted"})});n(".EPiServerForms .FormTextbox--Number .FormTextbox__Input").on("keydown",function(n){var t=n.which||n.keyCode,i;return!n.shiftKey&&!n.altKey&&!n.ctrlKey&&t>=65&&t<=90||t==32?!1:!n.shiftKey&&!n.altKey&&!n.ctrlKey&&t>=48&&t<=57||t>=96&&t<=105||n.keyCode==65&&n.ctrlKey===!0||t==67&&n.ctrlKey===!0||t==88&&n.ctrlKey===!0||t>=35&&t<=39||t==8||t==9||t==13||t==46||t==45?!0:(i=this.value,(t==109||t==189)&&i[0]==="-")?!1:(!n.shiftKey&&!n.altKey&&!n.ctrlKey&&t==190||t==188||t==110)&&/[\.,]/.test(i)?!1:void 0}).on("keyup",function(){var n=this.value;+n||n&&(n=(n[0]==="-"?"-":"")+n.replace(/[^0-9\.]/g,""),n=n.replace(/\.(?=(.*)\.)+/g,""),this.value=n)});n(".EPiServerForms input.FormTextbox__Input,.FormChoice__Input.FormChoice__Input--Checkbox,.FormRange__Input,.FormTextbox__Input.FormUrl__Input,.FormChoice__Input.FormChoice__Input--Radio,.FormTextbox__Input.FormCaptcha__Input.FormHideInSummarized").on("keydown",function(n){return t.showNextStepOnEnterKeyDown(n)})}))};epi.EPiServer.Forms.ExternalScriptSources.length<=0&&epi.EPiServer.Forms.ExternalCssSources.length<=0?epi.EPiServer.Forms.init():(t.loadExternalScriptOnDemand(epi.EPiServer.Forms.ExternalScriptSources,function(){t.raiseFormsEvent(null,{type:"formsLoadExternalScripts",scripts:epi.EPiServer.Forms.ExternalScriptSources});epi.EPiServer.Forms.init()}),t.loadExternalCssOnDemand(epi.EPiServer.Forms.ExternalCssSources,function(){t.raiseFormsEvent(null,{type:"formsLoadExternalCss",Css:epi.EPiServer.Forms.ExternalCssSources})}))})($$epiforms||$);